<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wikipedia Article Fetcher</title>
    <style>
        #content {
            width: 30%;
            height: 100vh;
            overflow-y: scroll;
            border: 1px solid #ccc;
            padding: 10px;
        }
        .input-container {
            display: flex;
            align-items: center;
        }
        .input-container input[type="text"] {
            margin-right: 10px;
        }
        .button-container {
            display: flex;
            align-items: center;
        }
        #checkboxContainer {
            display: inline-block;
            vertical-align: top;
            margin-left: 10px;
        }
        .content-container {
            display: flex;
        }
        #comparisonResults {
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <h1>Wikipedia Article Fetcher</h1>
    <div class="input-container">
        <input type="text" id="articleName" placeholder="Enter article name">
        <div class="button-container">
            <button onclick="fetchArticle()">Fetch Article</button>
            <button id="useArticleButton" disabled>Use Article</button>
        </div>
    </div>
    <div class="content-container">
        <div id="content"></div>
        <div id="checkboxContainer" style="display: none;"></div>
    </div>
    <button id="compareButton" onclick="compareArticles()" disabled>Compare</button>
    <div id="comparisonResults"></div>

    <script>
        async function fetchArticle() {
            const articleName = document.getElementById('articleName').value;
            const response = await fetch('/fetch_article', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    'articleName': articleName
                })
            });

            const data = await response.json();
            if (response.ok) {
                document.getElementById('content').innerHTML = `<h2>${data.title}</h2><p>${data.summary}</p>`;
                document.getElementById('useArticleButton').disabled = false;
            } else {
                document.getElementById('content').innerHTML = `<p>Error fetching article: ${data.error}</p>`;
                document.getElementById('useArticleButton').disabled = true;
            }
        }

        async function fetchRecommendations() {
            const articleName = document.getElementById('articleName').value;
            const response = await fetch('/get_recommendations', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    'articleName': articleName
                })
            });

            const data = await response.json();
            if (response.ok) {
                const enTitleContainer = document.getElementById('checkboxContainer');
                enTitleContainer.innerHTML = ''; // Clear previous content
                data.recommendations.forEach((recommendation, index) => {
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = `recommendationCheckbox${index}`;
                    checkbox.value = recommendation;
                    checkbox.onchange = toggleCompareButton;

                    const label = document.createElement('label');
                    label.htmlFor = checkbox.id;
                    label.textContent = recommendation;

                    enTitleContainer.appendChild(checkbox);
                    enTitleContainer.appendChild(label);
                    enTitleContainer.appendChild(document.createElement('br'));
                });
                enTitleContainer.style.display = 'inline-block';
            } else {
                console.error('Failed to fetch recommendations');
            }
        }

        document.getElementById('useArticleButton').addEventListener('click', fetchRecommendations);

        function toggleCompareButton() {
            const compareButton = document.getElementById('compareButton');
            const checkboxes = document.querySelectorAll('#checkboxContainer input[type="checkbox"]');
            compareButton.disabled = !Array.from(checkboxes).some(checkbox => checkbox.checked);
        }

    async function compareArticles() {
    const articleName = document.getElementById('articleName').value;
    const selectedRecommendations = Array.from(document.querySelectorAll('#checkboxContainer input[type="checkbox"]:checked'))
        .map(checkbox => checkbox.value);
    const response = await fetch('/compare_articles', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: new URLSearchParams({
            'articleName': articleName,
            'recommendations': JSON.stringify(selectedRecommendations)
        })
    });

    const data = await response.json();
    if (response.ok) {
        const comparisonResults = document.getElementById('comparisonResults');
        comparisonResults.innerHTML = '';

        for (const [recommendation, results] of Object.entries(data.comparison_results)) {
            const recommendationElement = document.createElement('div');
            recommendationElement.innerHTML = `<strong>${recommendation}:</strong>`;
            results.forEach(result => {
                const resultElement = document.createElement('div');
                resultElement.textContent = result;
                recommendationElement.appendChild(resultElement);
            });
            comparisonResults.appendChild(recommendationElement);
        }
    } else {
        console.error('Failed to compare articles');
    }
}
        // old single handed compare function, remove later

        {#async function compareArticles() {#}
        {#    const articleName = document.getElementById('articleName').value;#}
        {#    const selectedRecommendations = Array.from(document.querySelectorAll('#checkboxContainer input[type="checkbox"]:checked'))#}
        {#        .map(checkbox => checkbox.value);#}
        {#    const response = await fetch('/compare_articles', {#}
        {#        method: 'POST',#}
        {#        headers: {#}
        {#            'Content-Type': 'application/x-www-form-urlencoded',#}
        {#        },#}
        {#        body: new URLSearchParams({#}
        {#            'articleName': articleName,#}
        {#            'recommendations': JSON.stringify(selectedRecommendations)#}
        {#        })#}
        {#    });#}
        {##}
        {#    const data = await response.json();#}
        {#    if (response.ok) {#}
        {#        const comparisonResults = document.getElementById('comparisonResults');#}
        {#        comparisonResults.innerHTML = '<ul>' + data.comparison_results.map(result => `<li>${result}</li>`).join('') + '</ul>';#}
        {#    } else {#}
        {#        console.error('Failed to compare articles');#}
        {#    }#}
        {#}#}
    </script>
</body>
</html>